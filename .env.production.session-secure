# PRODUCTION SESSION SECURITY CONFIGURATION
# 
# CRITICAL: Add these environment variables to your Sliplane deployment
# to eliminate session bleeding vulnerabilities.

# =========================================
# SESSION STORE CONFIGURATION (REQUIRED)
# =========================================

# Option 1: Redis Cloud (Recommended for Sliplane)
# Get from: https://redis.com/cloud/ or https://upstash.com/
REDIS_URL=redis://username:password@redis-host:port
# Alternative format for some providers:
REDIS_PRIVATE_URL=rediss://username:password@redis-host:port

# Option 2: Redis Connection Parameters (if URL not available)
REDIS_HOST=your-redis-host.com
REDIS_PORT=6379
REDIS_PASSWORD=your-redis-password

# =========================================
# SESSION SECURITY SETTINGS
# =========================================

# Generate a strong session secret (NEVER use this example!)
# Generate with: openssl rand -hex 32
SESSION_SECRET=CHANGE_ME_GENERATE_STRONG_SECRET_32_CHARS_MINIMUM

# Session configuration
SESSION_TTL=86400                    # 24 hours in seconds
SESSION_LOCK_TTL=30                  # 30 seconds for business switch locks
SESSION_MAX_RETRY_ATTEMPTS=3         # Max retry attempts for Redis operations

# =========================================
# DEPLOYMENT CONFIGURATION
# =========================================

# CRITICAL: Set to false in production to prevent global cache usage
NEXT_PUBLIC_ENABLE_GLOBAL_CACHE=false

# Process identification for diagnostics
WORKER_ID=${HOSTNAME:-worker-1}

# Session monitoring (enable in production for security monitoring)
ENABLE_SESSION_MONITORING=true
SESSION_DIAGNOSTICS_RETENTION=5000   # Keep last 5000 diagnostic entries

# =========================================
# SLIPLANE SPECIFIC SETTINGS
# =========================================

# Ensure single instance deployment initially
SLIPLANE_INSTANCE_COUNT=1

# Health check endpoint (doesn't create sessions)
HEALTH_CHECK_PATH=/api/health

# Static asset serving
SERVE_STATIC_FILES=true

# =========================================
# OPTIONAL: EXTERNAL SESSION VALIDATION
# =========================================

# If using external session validation service
# SESSION_VALIDATION_ENDPOINT=https://your-session-validator.com/validate
# SESSION_VALIDATION_SECRET=your-validation-secret

# =========================================
# DEBUGGING (Development/Staging Only)
# =========================================

# Enable detailed session logging (disable in production)
DEBUG_SESSION_FLOW=false
DEBUG_CACHE_HITS=false
DEBUG_REDIS_OPERATIONS=false

# Enable test endpoints (NEVER enable in production)
ENABLE_SESSION_TEST_ENDPOINTS=false

# =========================================
# EXAMPLE REDIS PROVIDERS
# =========================================

# Upstash Redis:
# REDIS_URL=rediss://:password@region-endpoint.upstash.io:port

# Redis Cloud:
# REDIS_URL=redis://username:password@redis-12345.c123.region.cache.amazonaws.com:6379

# Railway Redis:
# REDIS_URL=redis://:password@containers-us-west-id.railway.app:port

# DigitalOcean Managed Redis:
# REDIS_URL=rediss://:password@redis-cluster.fra1.db.ondigitalocean.com:25061

# =========================================
# SECURITY CHECKLIST
# =========================================
# □ Redis/session store configured and accessible
# □ SESSION_SECRET generated and set (32+ chars)
# □ NEXT_PUBLIC_ENABLE_GLOBAL_CACHE=false
# □ Single instance deployment initially (SLIPLANE_INSTANCE_COUNT=1)
# □ Session monitoring enabled
# □ All test/debug flags disabled for production
# □ Redis connection tested and working
# □ Session diagnostics endpoint accessible to admin users
# □ Application logs being monitored for session anomalies